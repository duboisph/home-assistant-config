device_tracker:
  - platform: nmap_tracker
    hosts: !secret nmap_tracker_hosts
    exclude:
      - !secret hass_host
    interval_seconds: 20
    consider_home: 360
    home_interval: 10
    new_device_defaults:
      track_new_devices: true

speedtestdotnet:

homeassistant:
  customize_glob:
    sensor.system_*:
      custom_ui_state_card: state-card-custom-ui
      templates:
        hs_color: "if (state === 'Online') return [0, 0];
          else if (state === 'Unknown') return [40, 70];
          else if (state === 'Offline') return [0, 85];"
  customize:
    sensor.count_automations:
      icon: mdi:robot
    sensor.count_binary_sensors:
      icon: mdi:contrast-circle
    sensor.count_lights:
      icon: mdi:lightbulb-on
    sensor.count_scripts:
      icon: mdi:script-text
    sensor.count_sensors:
      icon: mdi:developer-board
    sensor.count_switches:
      icon: mdi:light-switch
    sensor.system_58z72z2:
      icon: mdi:laptop-windows
    sensor.system_ariel:
      icon: mdi:laptop-windows
    sensor.system_avr_x6200w:
      icon: mdi:speaker
    sensor.system_cinema_harmony:
      icon: mdi:remote
    sensor.system_cinema_tv:
      icon: mdi:android
    sensor.system_fenrir:
      icon: mdi:laptop-windows
    sensor.system_freyja:
      icon: mdi:cellphone-android
    sensor.system_heimdallr:
      icon: mdi:router
    sensor.system_heimdallr_ap1:
      icon: mdi:router-wireless
    sensor.system_hel:
      icon: mdi:raspberry-pi
    sensor.system_iphone_van_elke:
      icon: mdi:cellphone-iphone
    sensor.system_kindle:
      icon: mdi:book-open
    sensor.system_living_harmony:
      icon: mdi:remote
    sensor.system_living_tv:
      icon: mdi:android
    sensor.system_loki:
      icon: mdi:tablet-ipad
    sensor.system_nintendoswitch:
      icon: mdi:nintendo-switch
    sensor.system_philips_hue:
      icon: mdi:home-lightbulb
    sensor.system_printer:
      icon: mdi:printer-wireless
    sensor.system_ps4pro:
      icon: mdi:playstation
    sensor.system_ring:
      icon: mdi:doorbell-video
    sensor.system_ringchime:
      icon: mdi:bell
    sensor.system_sonos_connect:
      icon: mdi:speaker-wireless
    sensor.system_sonos_play1:
      icon: mdi:speaker-wireless
    sensor.system_thor:
      icon: mdi:nas
    sensor.system_ubp_x800:
      icon: mdi:disc-player

sensor:
  #### CONNECTED DEVICES #######################################################

  - platform: template
    sensors:
      system_58z72z2:
        friendly_name: Werklaptop Elke
        entity_id: device_tracker.nmap_58z72z2
        value_template: >
          {% if is_state('device_tracker.nmap_58z72z2', 'home') %}
            Online
          {% elif is_state('device_tracker.nmap_58z72z2_2', 'home') %}
            Online
          {% else %}
            Offline
          {% endif %}
      system_ariel:
        friendly_name: Laptop Elke
        entity_id: device_tracker.nmap_ariel
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_ariel', 'home') else 'Offline' }}"
      system_avr_x6200w:
        friendly_name: Cinema AVR
        entity_id: device_tracker.nmap_avr_x6200w
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_avr_x6200w', 'home') else 'Offline' }}"
      system_cinema_harmony:
        friendly_name: Cinema Harmony
        entity_id: device_tracker.nmap_cinema_harmony
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_cinema_harmony', 'home') else 'Offline' }}"
      system_cinema_tv:
        friendly_name: Cinema TV
        entity_id: device_tracker.nmap_cinema_tv
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_cinema_tv:', 'home') else 'Offline' }}"
      system_fenrir:
        friendly_name: Fenrir
        entity_id:
          - device_tracker.nmap_fenrir
          - device_tracker.nmap_fenrir_2
        value_template: >
          {% if is_state('device_tracker.nmap_fenrir', 'home') %}
            Online
          {% elif is_state('device_tracker.nmap_fenrir_2', 'home') %}
            Online
          {% else %}
            Offline
          {% endif %}
      system_freyja:
        friendly_name: Freyja
        entity_id: device_tracker.nmap_freyja
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_freyja', 'home') else 'Offline' }}"
      system_heimdallr:
        friendly_name: Heimdallr
        entity_id: device_tracker.nmap_heimdallr
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_heimdallr', 'home') else 'Offline' }}"
      system_heimdallr_ap1:
        friendly_name: Heimdallr AP1
        entity_id: device_tracker.nmap_heimdallr_ap1
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_heimdallr_ap1', 'home') else 'Offline' }}"
      system_hel:
        friendly_name: Hel
        entity_id: device_tracker.nmap_hel
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_hel', 'home') else 'Offline' }}"
      system_iphone_van_elke:
        friendly_name: iPhone Elke
        entity_id: device_tracker.nmap_iphone_van_elke
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_iphone_van_elke', 'home') else 'Offline' }}"
      system_kindle:
        friendly_name: Kindle
        entity_id: device_tracker.nmap_kindle
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_kindle', 'home') else 'Offline' }}"
      system_living_harmony:
        friendly_name: Living Harmony
        entity_id: device_tracker.nmap_living_harmony
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_living_harmony', 'home') else 'Offline' }}"
      system_living_tv:
        friendly_name: Living TV
        entity_id: device_tracker.nmap_living_tv
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_living_tv', 'home') else 'Offline' }}"
      system_loki:
        friendly_name: Loki
        entity_id: device_tracker.nmap_loki
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_loki', 'home') else 'Offline' }}"
      system_nintendoswitch:
        friendly_name: Nintendo Switch
        entity_id: device_tracker.nmap_nintendoswitch
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_nintendoswitch', 'home') else 'Offline' }}"
      system_philips_hue:
        friendly_name: Hue Bridge
        entity_id: device_tracker.nmap_philips_hue
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_philips_hue', 'home') else 'Offline' }}"
      system_printer:
        friendly_name: Printer
        entity_id: device_tracker.nmap_printer
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_printer', 'home') else 'Offline' }}"
      system_ps4pro:
        friendly_name: PS4 Pro
        entity_id: device_tracker.nmap_ps4pro
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_ps4pro', 'home') else 'Offline' }}"
      system_ring:
        friendly_name: Ring
        entity_id: device_tracker.nmap_ring
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_ring', 'home') else 'Offline' }}"
      system_ringchime:
        friendly_name: Ring Chime
        entity_id: device_tracker.nmap_ringchime
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_ringchime', 'home') else 'Offline' }}"
      system_sonos_connect:
        friendly_name: Sonos CONNECT
        entity_id: device_tracker.nmap_sonos_connect
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_sonos_connect', 'home') else 'Offline' }}"
      system_sonos_play1:
        friendly_name: Sonos PLAY:1
        entity_id: device_tracker.nmap_sonos_play1
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_sonos_play1', 'home') else 'Offline' }}"
      system_thor:
        friendly_name: Thor
        entity_id: device_tracker.nmap_thor
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_thor', 'home') else 'Offline' }}"
      system_ubp_x800:
        friendly_name: Cinema Blu-Ray player
        entity_id: device_tracker.nmap_ubp_x800
        value_template: "{{ 'Online' if is_state('device_tracker.nmap_ubp_x800', 'home') else 'Offline' }}"

  #### SERVER MONITORING #######################################################

  - platform: systemmonitor
    resources:
      - type: disk_use_percent
        arg: "/"
      - type: memory_use_percent
      - type: processor_use
  - platform: synologydsm
    name: Thor
    host: !secret synology_host
    username: !secret synology_username
    password: !secret synology_password
    monitored_conditions:
      - cpu_total_load
      - memory_real_usage
      - network_up
      - network_down
      - disk_smart_status
      - volume_status
      - volume_percentage_used
      - volume_disk_temp_max

  #### WIREGUARD ###############################################################

  - platform: rest
    resource: http://a0d7b954-wireguard
    name: wireguard_sensor
    value_template: TEST
    json_attributes:
      - Loki
      - Freyja
      - Fenrir
  - platform: template
    sensors:
      wireguard_loki_latest_handshake:
        friendly_name: "Loki latest handshake"
        icon_template: "mdi:handshake"
        unit_of_measurement: s
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Loki"]["latest_handshake"] }}'
      wireguard_loki_tx:
        friendly_name: "Loki sent"
        icon_template: "mdi:upload"
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Loki"]["transfer_tx"] | filesizeformat }}'
      wireguard_loki_rx:
        friendly_name: "Loki received"
        icon_template: "mdi:download"
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Loki"]["transfer_rx"] | filesizeformat }}'
      wireguard_freyja_latest_handshake:
        friendly_name: "Freyja latest handshake"
        icon_template: "mdi:handshake"
        unit_of_measurement: s
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Freyja"]["latest_handshake"] }}'
      wireguard_freyja_tx:
        friendly_name: "Freyja sent"
        icon_template: "mdi:upload"
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Freyja"]["transfer_tx"] | filesizeformat }}'
      wireguard_freyja_rx:
        friendly_name: "Freyja received"
        icon_template: "mdi:download"
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Freyja"]["transfer_rx"] | filesizeformat }}'
      wireguard_fenrir_latest_handshake:
        friendly_name: "Fenrir latest handshake"
        icon_template: "mdi:handshake"
        unit_of_measurement: s
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Fenrir"]["latest_handshake"] }}'
      wireguard_fenrir_tx:
        friendly_name: "Fenrir sent"
        icon_template: "mdi:upload"
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Fenrir"]["transfer_tx"] | filesizeformat }}'
      wireguard_fenrir_rx:
        friendly_name: "Fenrir received"
        icon_template: "mdi:download"
        value_template: '{{ states.sensor.wireguard_sensor.attributes["Fenrir"]["transfer_rx"] | filesizeformat }}'

  #### COUNT ENTITIES ##########################################################

  - platform: template
    sensors:
      ## Count Automations
      count_automations:
        entity_id: sensor.date
        friendly_name: Automations
        value_template: >
          {%- set domains = ['automation'] -%}
          {%- for domain in domains -%}
            {%- for item in states[domain] -%}
              {% if loop.first %}
                {{loop.length}}
              {% endif %}
            {%- endfor -%}
          {%- endfor -%}
      ## Count Binary Sensors
      count_binary_sensors:
        entity_id: sensor.date
        friendly_name: Binary Sensors
        value_template: >
          {%- set domains = ['binary_sensor'] -%}
          {%- for domain in domains -%}
            {%- for item in states[domain] -%}
              {% if loop.first %}
                {{loop.length}}
              {% endif %}
            {%- endfor -%}
          {%- endfor -%}
      ## Count Lights
      count_lights:
        entity_id: sensor.date
        friendly_name: Lights
        value_template: >
          {%- set domains = ['light'] -%}
          {%- for domain in domains -%}
            {%- for item in states[domain] -%}
              {% if loop.first %}
                {{loop.length}}
              {% endif %}
            {%- endfor -%}
          {%- endfor -%}
      ## Count Scripts
      count_scripts:
        entity_id: sensor.date
        friendly_name: Scripts
        value_template: >
          {%- set domains = ['script'] -%}
          {%- for domain in domains -%}
            {%- for item in states[domain] -%}
              {% if loop.first %}
                {{loop.length}}
              {% endif %}
            {%- endfor -%}
          {%- endfor -%}
      ## Count Sensors
      count_sensors:
        entity_id: sensor.date
        friendly_name: Sensors
        value_template: >
          {%- set domains = ['sensor'] -%}
          {%- for domain in domains -%}
            {%- for item in states[domain] -%}
              {% if loop.first %}
                {{loop.length}}
              {% endif %}
            {%- endfor -%}
          {%- endfor -%}
      ## Count Switches
      count_switches:
        entity_id: sensor.date
        friendly_name: Switches
        value_template: >
          {%- set domains = ['switch'] -%}
          {%- for domain in domains -%}
            {%- for item in states[domain] -%}
              {% if loop.first %}
                {{loop.length}}
              {% endif %}
            {%- endfor -%}
          {%- endfor -%}
